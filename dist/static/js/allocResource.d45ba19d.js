(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["allocResource"],{"31c4":function(e,t,n){"use strict";var r=n("d9b4"),c=n.n(r);c.a},d9b4:function(e,t,n){},fb74:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-card",{staticClass:"form-container",attrs:{shadow:"never"}},[e._l(e.allResourceCate,(function(t,r){return n("div",{key:"cate"+t.id,class:0===r?"top-line":null},[n("el-row",{staticClass:"table-layout",staticStyle:{background:"#F2F6FC"}},[n("el-checkbox",{attrs:{indeterminate:e.isIndeterminate(t.id)},on:{change:function(n){return e.handleCheckAllChange(t)}},model:{value:t.selected,callback:function(n){e.$set(t,"selected",n)},expression:"cate.selected"}},[e._v(e._s(t.name))])],1),n("el-row",{staticClass:"table-layout"},e._l(e.getResourceByCate(t.id),(function(t){return n("el-col",{key:t.id,staticStyle:{padding:"4px 0"},attrs:{span:8}},[n("el-checkbox",{on:{change:function(n){return e.handleCheckChange(t)}},model:{value:t.selected,callback:function(n){e.$set(t,"selected",n)},expression:"resource.selected"}},[e._v(e._s(t.name))])],1)})),1)],1)})),n("div",{staticStyle:{"margin-top":"20px"},attrs:{align:"center"}},[n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleSave()}}},[e._v("保存")]),n("el-button",{on:{click:function(t){return e.handleClear()}}},[e._v("清空")])],1)],2)},c=[];n("4160"),n("159b"),n("e199");n("a4d3"),n("e01a"),n("99af"),n("b0c0");var l=n("ed08"),o={name:"allocResource",title:"角色资源管理",data:function(){return{roleId:null,allResource:null,allResourceCate:null,listQuery:{currentPage:1,pageSize:200}}},created:function(){this.roleId=this.$route.query.roleId,this.getCateList()},methods:{getCateList:function(){var e=this;l["b"].get("/ResourceCategory/findAllResourceCategory").then((function(t){e.allResourceCate=t.data.content;for(var n=0;n<e.allResourceCate.length;n++)e.allResourceCate[n].selected=!1;e.getResourceList()})).catch((function(t){e.$message.error("数据获取失败! ! !")}))},getResourceList:function(){var e=this;l["b"].post("/resource/findAllResource",this.listQuery).then((function(t){e.allResource=t.data.content.list;for(var n=0;n<e.allResource.length;n++)e.allResource[n].selected=!1;e.getResourceByRoleId(e.roleId)})).catch((function(t){e.$message.error("数据获取失败! ! !")}))},getResourceByRoleId:function(e){var t=this;l["b"].get("/role/findResourceListByRoleId?roleId="+e).then((function(e){var n=e.data.content;console.log(n),t.allResource.forEach((function(e){e.selected=t.getResourceChecked(e.id,n)})),t.allResourceCate.forEach((function(e){e.selected=t.isAllChecked(e.id)})),t.$forceUpdate()})).catch((function(e){t.$message.error("数据获取失败! ! !")}))},getResourceChecked:function(e,t){if(null==t||0===t.length)return!1;for(var n=!1,r=0;r<t.length;r++)t[r].resourceList.forEach((function(t){e==t.id&&(n=!0)}));return n},isAllChecked:function(e){var t=this.getResourceByCate(e);if(null==t)return!1;for(var n=0,r=0;r<t.length;r++)!0===t[r].selected&&n++;return 0!==n&&n===t.length},getResourceByCate:function(e){var t=[];if(null==this.allResource)return null;for(var n=0;n<this.allResource.length;n++){var r=this.allResource[n];r.categoryId===e&&t.push(r)}return t},isIndeterminate:function(e){var t=this.getResourceByCate(e);if(null==t)return!1;for(var n=0,r=0;r<t.length;r++)!0===t[r].selected&&n++;return!(0===n||n===t.length)},handleSave:function(){var e=this;this.$confirm("是否分配资源？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var t=[];null!=e.allResource&&e.allResource.length>0&&e.allResource.forEach((function(e){e.selected&&t.push(e.id)}));var n={roleId:e.roleId,resourceIdList:t};l["b"].post("/role/roleContextResource",n).then((function(t){e.$router.back()})).catch((function(t){e.$message.error("权限分配失败! ! !")}))}))},handleClear:function(){this.allResourceCate.forEach((function(e){e.selected=!1})),this.allResource.forEach((function(e){e.selected=!1})),this.$forceUpdate()},handleCheckAllChange:function(e){for(var t=this.getResourceByCate(e.id),n=0;n<t.length;n++)t[n].selected=e.selected;this.$forceUpdate()},handleCheckChange:function(e){var t=this;this.allResourceCate.forEach((function(n){n.id===e.categoryId&&(n.selected=t.isAllChecked(e.categoryId))})),this.$forceUpdate()}}},a=o,s=(n("31c4"),n("2877")),u=Object(s["a"])(a,r,c,!1,null,"dbab99bc",null);t["default"]=u.exports}}]);